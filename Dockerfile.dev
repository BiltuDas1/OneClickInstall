FROM biltudas1/oneclickinstall:qt-static

# Install Poetry
RUN wget https://install.python-poetry.org -O - | python3 -
ENV PATH="/root/.local/bin:${PATH}"

# Install ccache
RUN \
    export DEBIAN_FRONTEND=noninteractive && \
    apt -y update && \
    apt -y upgrade && \
    apt -y install ccache && \
    apt -y autoremove && \
    apt -y autoclean && \
    apt -y clean && \
    rm -rf /var/lib/apt/lists/* && \
    exit 0
ENV CC="ccache x86_64-w64-mingw32.shared-gcc"
ENV CXX="ccache x86_64-w64-mingw32.shared-g++"

# Install upx
RUN cd /opt && wget -O - https://github.com/upx/upx/releases/download/v5.0.2/upx-5.0.2-amd64_linux.tar.xz | tar -xJ
ENV PATH="/opt/upx-5.0.2-amd64_linux:${PATH}"

WORKDIR /mnt

# Install Packages
COPY pyproject.toml .
COPY poetry.lock .
RUN poetry install --with dev --no-root

ENTRYPOINT [ "/bin/bash", "debug.sh" ]